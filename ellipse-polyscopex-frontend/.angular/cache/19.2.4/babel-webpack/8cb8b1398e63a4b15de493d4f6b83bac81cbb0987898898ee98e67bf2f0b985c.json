{"ast":null,"code":"import _asyncToGenerator from \"/workspaces/polyscopex-0.18.90/ellipse-polyscopex/ellipse-polyscopex-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ChangeDetectorRef, SimpleChanges } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Acceleration, AccelerationUnits, AddNode, Angle, AngleUnits, FolderNode, InsertionEnum, Length, LengthUnits, MoveScreenOptions, MoveToBlendSettings, MoveToNode, MoveToSpeedSettings, MoveToTransformSettings, NodeType, ProgramPresenterAPI, RobotSettings, Speed, SpeedUnits, TabInputModel, URVariable, Value, VariableValueType, Waypoint, WaypointTabInputModel } from '@universal-robots/contribution-api';\nimport { ANGULAR_STEP_DISTANCE, HORIZONTAL_RADIUS_IN_M, NUMBER_OF_WAYPOINTS, SHARED_BLEND_RADIUS_IN_M, SHARED_TOOL_ACCELERATION_IN_M_S2, SHARED_TOOL_SPEED_IN_M_S, VERTICAL_RADIUS_IN_M } from './ellipse-pg.node';\nimport { first } from 'rxjs/operators';\nimport { SelectedInput } from '@universal-robots/ui-models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngx-translate/core\";\nimport * as i2 from \"@universal-robots/ui-angular-components\";\nfunction EllipsePgComponent_Conditional_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 0);\n    i0.ɵɵelement(1, \"ur-title\", 1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementStart(3, \"ur-button\", 2);\n    i0.ɵɵlistener(\"handleClick\", function EllipsePgComponent_Conditional_0_Template_ur_button_handleClick_3_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onEditButtonClick());\n    });\n    i0.ɵɵtext(4, \"Edit Center\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"ur-button\", 3);\n    i0.ɵɵlistener(\"handleClick\", function EllipsePgComponent_Conditional_0_Template_ur_button_handleClick_5_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onMoveHereButtonClick());\n    });\n    i0.ɵɵtext(6, \"Move Here\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(2, 7, \"program.tree.nodes.description\"))(\"type\", \"subheading\")(\"weight\", \"default\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.contributedNode.parameters.waypoint.pose.position[0] !== 0)(\"active\", false);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.contributedNode.parameters.waypoint.pose.position[0] === 0)(\"active\", false);\n  }\n}\nexport let EllipsePgComponent = /*#__PURE__*/(() => {\n  class EllipsePgComponent {\n    translateService;\n    cd;\n    // presenterAPI is optional\n    presenterAPI;\n    // robotSettings is optional\n    robotSettings;\n    // contributedNode is optional\n    contributedNode;\n    constructor(translateService, cd) {\n      this.translateService = translateService;\n      this.cd = cd;\n    }\n    ngOnChanges(changes) {\n      if (changes?.robotSettings) {\n        if (!changes?.robotSettings?.currentValue) {\n          return;\n        }\n        if (changes?.robotSettings?.isFirstChange()) {\n          if (changes?.robotSettings?.currentValue) {\n            this.translateService.use(changes?.robotSettings?.currentValue?.language);\n          }\n          this.translateService.setDefaultLang('en');\n        }\n        this.translateService.use(changes?.robotSettings?.currentValue?.language).pipe(first()).subscribe(() => {\n          this.cd.detectChanges();\n        });\n      }\n      if (changes?.presenterAPI && this.presenterAPI) {\n        console.log(`Current node waypoint value: Orientation:: ${this.contributedNode.parameters.waypoint.pose.orientation}`);\n        console.log(`Position:: ${this.contributedNode.parameters.waypoint.pose.position}`);\n      }\n    }\n    onEditButtonClick() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        console.log('Edit center button clicked!');\n        const options = {\n          moveScreenTarget: 'waypoint',\n          moveScreenTargetLabel: 'center pose'\n        };\n        const waypoint = yield _this.presenterAPI.robotMoveService.openMoveScreen(options);\n        const treeservice = _this.presenterAPI.programTreeService;\n        const builder = _this.presenterAPI.builder;\n        const folderNode = yield builder.createNode(NodeType.FOLDER);\n        folderNode.parameters.folderName = 'Folder-ellipse-works!';\n        const folderBranchNode = _this.presenterAPI.builder.createBranchNode(folderNode);\n        folderBranchNode.allowsChildren = false;\n        folderBranchNode.lockChildren = true;\n        if (waypoint !== undefined) {\n          _this.contributedNode.parameters.waypoint = waypoint;\n          const baseAngle = waypoint.qNear.base + Math.PI / 2;\n          const xContribution = Math.cos(baseAngle);\n          const yContribution = Math.sin(baseAngle);\n          let angle = -Math.PI;\n          for (let i = 0; i < NUMBER_OF_WAYPOINTS; i++) {\n            angle += ANGULAR_STEP_DISTANCE;\n            let offsetX = Math.cos(angle) * HORIZONTAL_RADIUS_IN_M * xContribution;\n            let offsetY = Math.cos(angle) * HORIZONTAL_RADIUS_IN_M * yContribution;\n            let offsetZ = Math.sin(-angle) * VERTICAL_RADIUS_IN_M;\n            let movetonode = yield _this.createMoveToNodes('moveL', `EllisePoint${i}`, _this.contributedNode.parameters.waypoint, [offsetX, offsetY, offsetZ]); // add one movetonode into subtree!\n            folderBranchNode.children.push(movetonode);\n            console.log('wayoint added!');\n          }\n          let addNode = {\n            insertionRelativeToPivotNode: InsertionEnum.INTO_LAST,\n            //into subtree's bottom\n            node: folderBranchNode,\n            pivotNodeId: _this.presenterAPI.selectedNodeId\n          };\n          treeservice.addNode(addNode);\n        } else {\n          console.error('Waypoint is undefined!');\n        }\n        _this.saveNode();\n      })();\n    }\n    onMoveHereButtonClick() {\n      console.log('Move here button clicked!');\n      this.presenterAPI.robotMoveService.autoMove(this.contributedNode.parameters.waypoint);\n    }\n    createMoveToNodes(moveType, suggestdName, waypoint, delta) {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const builder = _this2.presenterAPI.builder;\n        const movetonode = yield builder.createNode(NodeType.MOVE_TO);\n        const symbolService = _this2.presenterAPI.symbolService;\n        ////movetonode settings/////////////////////////\n        const waypointTabInputModel = {\n          frame: 'base',\n          qNear: waypoint.qNear,\n          tcp: waypoint.tcp,\n          pose: {\n            rx: new TabInputModel({\n              value: waypoint.pose.orientation[0],\n              unit: AngleUnits[0] //radian\n            }, SelectedInput.VALUE, waypoint.pose.orientation[0]),\n            ry: new TabInputModel({\n              value: waypoint.pose.orientation[1],\n              unit: AngleUnits[0] //radian\n            }, SelectedInput.VALUE, waypoint.pose.orientation[1]),\n            rz: new TabInputModel({\n              value: waypoint.pose.orientation[2],\n              unit: AngleUnits[0] //radian\n            }, SelectedInput.VALUE, waypoint.pose.orientation[2]),\n            x: new TabInputModel({\n              value: waypoint.pose.position[0] + delta[0],\n              unit: LengthUnits[0] //meter\n            }, SelectedInput.VALUE, waypoint.pose.position[0] + delta[0]),\n            y: new TabInputModel({\n              value: waypoint.pose.position[1] + delta[1],\n              unit: LengthUnits[0] //meter\n            }, SelectedInput.VALUE, waypoint.pose.position[1] + delta[1]),\n            z: new TabInputModel({\n              value: waypoint.pose.position[2] + delta[2],\n              unit: LengthUnits[0] //meter\n            }, SelectedInput.VALUE, waypoint.pose.position[2] + delta[2])\n          }\n        };\n        movetonode.parameters.waypoint = waypointTabInputModel;\n        movetonode.parameters.moveType = 'moveL';\n        const pointName = yield symbolService.generateVariable(suggestdName, VariableValueType.WAYPOINT);\n        movetonode.parameters.variable = new TabInputModel(pointName, SelectedInput.VALUE, pointName.name);\n        const blendSettings = {\n          enabled: true,\n          radius: new TabInputModel({\n            value: SHARED_BLEND_RADIUS_IN_M,\n            unit: LengthUnits[0] //meter\n          }, SelectedInput.VALUE, SHARED_BLEND_RADIUS_IN_M)\n        };\n        const speedSettings = {\n          acceleration: new TabInputModel({\n            value: SHARED_TOOL_ACCELERATION_IN_M_S2,\n            unit: AccelerationUnits[0] //meter/s2\n          }, SelectedInput.VALUE, SHARED_TOOL_ACCELERATION_IN_M_S2),\n          speed: new TabInputModel({\n            value: SHARED_TOOL_SPEED_IN_M_S,\n            unit: SpeedUnits[0] //meter/s\n          }, SelectedInput.VALUE, SHARED_TOOL_SPEED_IN_M_S),\n          motionValue: '',\n          optiMoveSpeed: new TabInputModel({\n            value: 0,\n            unit: '' // Provide an empty unit or the appropriate string value as required\n          }, SelectedInput.VALUE, 0),\n          optiMoveAcceleration: new TabInputModel({\n            value: 0,\n            unit: '' // Provide an empty unit or the appropriate string value as required\n          }, SelectedInput.VALUE, 0)\n        };\n        const transformSettings = {\n          transform: false\n        };\n        movetonode.parameters.advanced = {\n          speed: speedSettings,\n          blend: blendSettings,\n          transform: transformSettings\n        };\n        ////end of movetonode settings/////////////////////////\n        return movetonode;\n      })();\n    }\n    // call saveNode to save node parameters\n    saveNode() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        _this3.cd.detectChanges();\n        yield _this3.presenterAPI.programNodeService.updateNode(_this3.contributedNode);\n      })();\n    }\n    static ɵfac = function EllipsePgComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || EllipsePgComponent)(i0.ɵɵdirectiveInject(i1.TranslateService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: EllipsePgComponent,\n      selectors: [[\"ng-component\"]],\n      inputs: {\n        presenterAPI: \"presenterAPI\",\n        robotSettings: \"robotSettings\",\n        contributedNode: \"contributedNode\"\n      },\n      standalone: false,\n      features: [i0.ɵɵNgOnChangesFeature],\n      decls: 1,\n      vars: 1,\n      consts: [[1, \"inline-component\"], [3, \"text\", \"type\", \"weight\"], [\"type\", \"cta\", \"icon\", \"record\", \"iconAlign\", \"left\", 3, \"handleClick\", \"disabled\", \"active\"], [\"type\", \"filled\", \"icon\", \"manual\", \"iconAlign\", \"left\", 3, \"handleClick\", \"disabled\", \"active\"]],\n      template: function EllipsePgComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtemplate(0, EllipsePgComponent_Conditional_0_Template, 7, 9, \"div\", 0);\n        }\n        if (rf & 2) {\n          i0.ɵɵconditional(ctx.contributedNode ? 0 : -1);\n        }\n      },\n      dependencies: [i2.URButtonComponent, i2.URTitleComponent, i1.TranslatePipe],\n      styles: [\".inline-component[_ngcontent-%COMP%]{display:flex;align-items:center;height:40px;gap:var(--spacing-03)}\"],\n      changeDetection: 0\n    });\n  }\n  return EllipsePgComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}