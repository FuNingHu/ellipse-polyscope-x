{"ast":null,"code":"import _asyncToGenerator from \"/workspaces/polyscopex-0.18.90/ellipse-polyscopex/ellipse-polyscopex-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _asyncIterator from \"/workspaces/polyscopex-0.18.90/ellipse-polyscopex/ellipse-polyscopex-frontend/node_modules/@babel/runtime/helpers/esm/asyncIterator.js\";\nimport { ChangeDetectorRef, SimpleChanges } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Acceleration, AccelerationUnits, AddNode, Angle, AngleUnits, InsertionEnum, Length, LengthUnits, MoveScreenOptions, MoveToBlendSettings, MoveToNode, MoveToSpeedSettings, MoveToTransformSettings, NodeType, ProgramPresenterAPI, RemoveNode, RobotSettings, Speed, SpeedUnits, TabInputModel, URVariable, Value, VariableValueType, Waypoint, WaypointTabInputModel } from '@universal-robots/contribution-api';\nimport { ANGULAR_STEP_DISTANCE, HORIZONTAL_RADIUS_IN_M, NUMBER_OF_WAYPOINTS, SHARED_BLEND_RADIUS_IN_M, SHARED_TOOL_ACCELERATION_IN_M_S2, SHARED_TOOL_SPEED_IN_M_S, VERTICAL_RADIUS_IN_M } from './ellipse-pg.node';\nimport { first } from 'rxjs/operators';\nimport { SelectedInput } from '@universal-robots/ui-models';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@ngx-translate/core\";\nimport * as i2 from \"@universal-robots/ui-angular-components\";\nfunction EllipsePgComponent_Conditional_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 0);\n    i0.ɵɵelement(1, \"ur-title\", 1);\n    i0.ɵɵpipe(2, \"translate\");\n    i0.ɵɵelementStart(3, \"ur-button\", 2);\n    i0.ɵɵlistener(\"handleClick\", function EllipsePgComponent_Conditional_0_Template_ur_button_handleClick_3_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onEditButtonClick());\n    });\n    i0.ɵɵtext(4, \"Edit Center\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"ur-button\", 3);\n    i0.ɵɵlistener(\"handleClick\", function EllipsePgComponent_Conditional_0_Template_ur_button_handleClick_5_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onMoveHereButtonClick());\n    });\n    i0.ɵɵtext(6, \"Move Here\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"ur-button\", 3);\n    i0.ɵɵlistener(\"handleClick\", function EllipsePgComponent_Conditional_0_Template_ur_button_handleClick_7_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.onSelectLastChildNodeClick());\n    });\n    i0.ɵɵtext(8, \"Set Child Active\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"text\", i0.ɵɵpipeBind1(2, 9, \"program.tree.nodes.description\"))(\"type\", \"subheading\")(\"weight\", \"default\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", false)(\"active\", false);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.contributedNode.parameters.waypoint.pose.position[0] === 0)(\"active\", false);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", false)(\"active\", false);\n  }\n}\nexport let EllipsePgComponent = /*#__PURE__*/(() => {\n  class EllipsePgComponent {\n    translateService;\n    cd;\n    // presenterAPI is optional\n    presenterAPI;\n    // robotSettings is optional\n    robotSettings;\n    // contributedNode is optional\n    contributedNode;\n    constructor(translateService, cd) {\n      this.translateService = translateService;\n      this.cd = cd;\n    }\n    ngOnChanges(changes) {\n      if (changes?.robotSettings) {\n        if (!changes?.robotSettings?.currentValue) {\n          return;\n        }\n        if (changes?.robotSettings?.isFirstChange()) {\n          if (changes?.robotSettings?.currentValue) {\n            this.translateService.use(changes?.robotSettings?.currentValue?.language);\n          }\n          this.translateService.setDefaultLang('en');\n        }\n        this.translateService.use(changes?.robotSettings?.currentValue?.language).pipe(first()).subscribe(() => {\n          this.cd.detectChanges();\n        });\n      }\n      if (changes?.presenterAPI && this.presenterAPI) {\n        console.log(`[ngOnChanges] Current node waypoint value: Orientation:: ${this.contributedNode.parameters.waypoint.pose.orientation}`);\n        console.log(`[ngOnChanges] Position:: ${this.contributedNode.parameters.waypoint.pose.position}`);\n      }\n      if (changes?.contributedNode && this.contributedNode) {\n        console.log(`[ngOnChanges] ContributedNode changed. Waypoint value: Orientation:: ${this.contributedNode.parameters.waypoint.pose.orientation}`);\n        console.log(`[ngOnChanges] Position:: ${this.contributedNode.parameters.waypoint.pose.position}`);\n      }\n    }\n    onEditButtonClick() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        console.log('Edit center button clicked!');\n        const options = {\n          moveScreenTarget: 'waypoint',\n          moveScreenTargetLabel: 'center pose'\n        };\n        const waypoint = yield _this.presenterAPI.robotMoveService.openMoveScreen(options);\n        const treeservice = _this.presenterAPI.programTreeService;\n        const builder = _this.presenterAPI.builder;\n        console.log('Waypoint returned from openMoveScreen:', waypoint);\n        if (waypoint) {\n          console.log('Waypoint position:', waypoint.pose.position);\n          console.log('Waypoint orientation:', waypoint.pose.orientation);\n        }\n        // 检查 waypoint 是否有效\n        // 如果 waypoint 存在且 position 不全为 0（可能是用户取消时返回的默认值）\n        const isValidWaypoint = waypoint !== undefined && waypoint !== null && (waypoint.pose.position[0] !== 0 || waypoint.pose.position[1] !== 0 || waypoint.pose.position[2] !== 0);\n        if (isValidWaypoint) {\n          console.log('Valid waypoint received, processing...');\n          // 先删除所有现有的子节点\n          yield _this.deleteAllChildNodes();\n          // 使用局部变量保存 waypoint，避免在添加节点时被重置\n          const savedWaypoint = waypoint;\n          // 先设置 waypoint 并立即保存，避免在添加节点时被重置\n          _this.contributedNode.parameters.waypoint = savedWaypoint;\n          console.log('Waypoint set to contributedNode. Saving node...');\n          yield _this.saveNode();\n          console.log('Node saved. Current waypoint value:');\n          console.log(`Orientation:: ${_this.contributedNode.parameters.waypoint.pose.orientation}`);\n          console.log(`Position:: ${_this.contributedNode.parameters.waypoint.pose.position}`);\n          // 保存后再创建和添加子节点，使用局部变量确保使用正确的 waypoint\n          const baseAngle = savedWaypoint.qNear.base + Math.PI / 2;\n          const xContribution = Math.cos(baseAngle);\n          const yContribution = Math.sin(baseAngle);\n          let angle = -Math.PI;\n          const pivotNodeId = _this.presenterAPI.selectedNodeId;\n          for (let i = 0; i < NUMBER_OF_WAYPOINTS; i++) {\n            angle += ANGULAR_STEP_DISTANCE;\n            let offsetX = Math.cos(angle) * HORIZONTAL_RADIUS_IN_M * xContribution;\n            let offsetY = Math.cos(angle) * HORIZONTAL_RADIUS_IN_M * yContribution;\n            let offsetZ = Math.sin(-angle) * VERTICAL_RADIUS_IN_M;\n            // 使用局部变量保存的 waypoint 创建节点，避免 contributedNode 被重置\n            let movetonode = yield _this.createMoveToNodes('moveL', `EllipsePoint${i}`, savedWaypoint, [offsetX, offsetY, offsetZ]);\n            // 直接将 waypoint 节点作为 ellipse-pg 的子节点插入\n            let addNode = {\n              changeSelection: false,\n              insertionRelativeToPivotNode: InsertionEnum.INTO_LAST,\n              node: movetonode,\n              pivotNodeId: pivotNodeId\n            };\n            treeservice.addNode(addNode);\n            console.log('waypoint added!');\n          }\n        } else {\n          if (waypoint === undefined || waypoint === null) {\n            console.error('Waypoint is undefined or null! User may have cancelled the move screen.');\n          } else {\n            console.error('Waypoint received but appears to be default/invalid values (0,0,0). User may have cancelled the move screen.');\n            console.error('Received waypoint:', waypoint);\n          }\n        }\n      })();\n    }\n    onMoveHereButtonClick() {\n      console.log('Move here button clicked!');\n      this.presenterAPI.robotMoveService.autoMove(this.contributedNode.parameters.waypoint);\n    }\n    // 设置最后一个子节点为活动的程序块\n    onSelectLastChildNodeClick() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        console.log('Set Child Active button clicked!');\n        try {\n          let currentNodeId = _this2.presenterAPI.selectedNodeId;\n          console.log(`Initial selected node ID: ${currentNodeId}`);\n          if (!currentNodeId) {\n            console.error('No node ID available. Cannot set child node active.');\n            return;\n          }\n          // 获取当前节点的信息，检查是否是 ellipse-pg 节点\n          const currentNode = yield _this2.presenterAPI.programTreeService.getProgramNodeById(currentNodeId);\n          console.log(`Current node type: ${currentNode.type}`);\n          // 如果当前选中的不是 ellipse-pg 节点，需要找到它的父节点（ellipse-pg 节点）\n          if (currentNode.type !== 'funh-ellipse-polyscopex-ellipse-pg') {\n            console.log('Current node is not ellipse-pg, finding parent node...');\n            const subtreeContext = yield _this2.presenterAPI.programTreeService.getSubtreeContextFromProgramNodeById(currentNodeId);\n            // 遍历祖先节点，找到 ellipse-pg 节点\n            var _iteratorAbruptCompletion = false;\n            var _didIteratorError = false;\n            var _iteratorError;\n            try {\n              for (var _iterator = _asyncIterator(subtreeContext.ancestors), _step; _iteratorAbruptCompletion = !(_step = yield _iterator.next()).done; _iteratorAbruptCompletion = false) {\n                const ancestor = _step.value;\n                {\n                  if (ancestor.node && ancestor.node.type === 'funh-ellipse-polyscopex-ellipse-pg') {\n                    currentNodeId = ancestor.id;\n                    console.log(`Found ellipse-pg parent node ID: ${currentNodeId}`);\n                    break;\n                  }\n                }\n              }\n              // 如果还是没找到，尝试使用 contributedNode 的类型来查找\n            } catch (err) {\n              _didIteratorError = true;\n              _iteratorError = err;\n            } finally {\n              try {\n                if (_iteratorAbruptCompletion && _iterator.return != null) {\n                  yield _iterator.return();\n                }\n              } finally {\n                if (_didIteratorError) {\n                  throw _iteratorError;\n                }\n              }\n            }\n            if (currentNode.type !== 'funh-ellipse-polyscopex-ellipse-pg') {\n              // 获取所有 ellipse-pg 节点实例\n              const instances = yield _this2.presenterAPI.programTreeService.getContributedNodeInstancesForURCap();\n              const ellipsePgInstance = instances.find(inst => inst.node.type === 'funh-ellipse-polyscopex-ellipse-pg');\n              if (ellipsePgInstance) {\n                currentNodeId = ellipsePgInstance.id;\n                console.log(`Found ellipse-pg node from instances: ${currentNodeId}`);\n              }\n            }\n          }\n          if (!currentNodeId) {\n            console.error('Could not find ellipse-pg node ID. Cannot set child node active.');\n            return;\n          }\n          console.log(`Using node ID to find children: ${currentNodeId}`);\n          const subtreeContext = yield _this2.presenterAPI.programTreeService.getSubtreeContextFromProgramNodeById(currentNodeId);\n          // 收集所有子节点的 ID\n          const childNodeIds = [];\n          var _iteratorAbruptCompletion2 = false;\n          var _didIteratorError2 = false;\n          var _iteratorError2;\n          try {\n            for (var _iterator2 = _asyncIterator(subtreeContext.children), _step2; _iteratorAbruptCompletion2 = !(_step2 = yield _iterator2.next()).done; _iteratorAbruptCompletion2 = false) {\n              const child = _step2.value;\n              {\n                if (child.id) {\n                  childNodeIds.push(child.id);\n                  console.log(`Found child node: ${child.id}, type: ${child.node?.type}`);\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError2 = true;\n            _iteratorError2 = err;\n          } finally {\n            try {\n              if (_iteratorAbruptCompletion2 && _iterator2.return != null) {\n                yield _iterator2.return();\n              }\n            } finally {\n              if (_didIteratorError2) {\n                throw _iteratorError2;\n              }\n            }\n          }\n          console.log(`Found ${childNodeIds.length} child nodes`);\n          if (childNodeIds.length === 0) {\n            console.log('No child nodes to set active');\n            return;\n          }\n          // 设置最后一个子节点为活动的程序块\n          const lastChildNodeId = childNodeIds[childNodeIds.length - 1];\n          console.log(`Setting last child node as active program block: ${lastChildNodeId}`);\n          yield _this2.presenterAPI.programTreeService.setActiveProgramBlock(lastChildNodeId);\n          console.log(`Successfully set last child node as active program block: ${lastChildNodeId}`);\n          // 触发变更检测\n          _this2.cd.detectChanges();\n        } catch (error) {\n          console.error('Error setting child node active:', error);\n          console.error('Error details:', JSON.stringify(error, null, 2));\n        }\n      })();\n    }\n    createMoveToNodes(moveType, suggestdName, waypoint, delta) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const builder = _this3.presenterAPI.builder;\n        const movetonode = yield builder.createNode(NodeType.MOVE_TO);\n        const symbolService = _this3.presenterAPI.symbolService;\n        ////movetonode settings/////////////////////////\n        const waypointTabInputModel = {\n          frame: 'base',\n          qNear: waypoint.qNear,\n          tcp: waypoint.tcp,\n          pose: {\n            rx: new TabInputModel({\n              value: waypoint.pose.orientation[0],\n              unit: AngleUnits[0] //radian\n            }, SelectedInput.VALUE, waypoint.pose.orientation[0]),\n            ry: new TabInputModel({\n              value: waypoint.pose.orientation[1],\n              unit: AngleUnits[0] //radian\n            }, SelectedInput.VALUE, waypoint.pose.orientation[1]),\n            rz: new TabInputModel({\n              value: waypoint.pose.orientation[2],\n              unit: AngleUnits[0] //radian\n            }, SelectedInput.VALUE, waypoint.pose.orientation[2]),\n            x: new TabInputModel({\n              value: waypoint.pose.position[0] + delta[0],\n              unit: LengthUnits[0] //meter\n            }, SelectedInput.VALUE, waypoint.pose.position[0] + delta[0]),\n            y: new TabInputModel({\n              value: waypoint.pose.position[1] + delta[1],\n              unit: LengthUnits[0] //meter\n            }, SelectedInput.VALUE, waypoint.pose.position[1] + delta[1]),\n            z: new TabInputModel({\n              value: waypoint.pose.position[2] + delta[2],\n              unit: LengthUnits[0] //meter\n            }, SelectedInput.VALUE, waypoint.pose.position[2] + delta[2])\n          }\n        };\n        movetonode.parameters.waypoint = waypointTabInputModel;\n        movetonode.parameters.moveType = 'moveL';\n        const pointName = yield symbolService.generateVariable(suggestdName, VariableValueType.WAYPOINT);\n        movetonode.parameters.variable = new TabInputModel(pointName, SelectedInput.VALUE, pointName.name);\n        const blendSettings = {\n          enabled: true,\n          radius: new TabInputModel({\n            value: SHARED_BLEND_RADIUS_IN_M,\n            unit: LengthUnits[0] //meter\n          }, SelectedInput.VALUE, SHARED_BLEND_RADIUS_IN_M)\n        };\n        const speedSettings = {\n          acceleration: new TabInputModel({\n            value: SHARED_TOOL_ACCELERATION_IN_M_S2,\n            unit: AccelerationUnits[0] //meter/s2\n          }, SelectedInput.VALUE, SHARED_TOOL_ACCELERATION_IN_M_S2),\n          speed: new TabInputModel({\n            value: SHARED_TOOL_SPEED_IN_M_S,\n            unit: SpeedUnits[0] //meter/s\n          }, SelectedInput.VALUE, SHARED_TOOL_SPEED_IN_M_S),\n          motionValue: '',\n          optiMoveSpeed: new TabInputModel({\n            value: 0,\n            unit: '' // Provide an empty unit or the appropriate string value as required\n          }, SelectedInput.VALUE, 0),\n          optiMoveAcceleration: new TabInputModel({\n            value: 0,\n            unit: '' // Provide an empty unit or the appropriate string value as required\n          }, SelectedInput.VALUE, 0)\n        };\n        const transformSettings = {\n          transform: false\n        };\n        movetonode.parameters.advanced = {\n          speed: speedSettings,\n          blend: blendSettings,\n          transform: transformSettings\n        };\n        ////end of movetonode settings/////////////////////////\n        return movetonode;\n      })();\n    }\n    // call saveNode to save node parameters\n    saveNode() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        _this4.cd.detectChanges();\n        yield _this4.presenterAPI.programNodeService.updateNode(_this4.contributedNode);\n      })();\n    }\n    // 删除最后一个子节点\n    deleteAllChildNodes() {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        console.log('Clear Child Nodes button clicked!');\n        try {\n          let currentNodeId = _this5.presenterAPI.selectedNodeId;\n          console.log(`Initial selected node ID: ${currentNodeId}`);\n          if (!currentNodeId) {\n            console.error('No node ID available. Cannot delete child nodes.');\n            return;\n          }\n          // 获取当前节点的信息，检查是否是 ellipse-pg 节点\n          const currentNode = yield _this5.presenterAPI.programTreeService.getProgramNodeById(currentNodeId);\n          console.log(`Current node type: ${currentNode.type}`);\n          // 如果当前选中的不是 ellipse-pg 节点，需要找到它的父节点（ellipse-pg 节点）\n          if (currentNode.type !== 'funh-ellipse-polyscopex-ellipse-pg') {\n            console.log('Current node is not ellipse-pg, finding parent node...');\n            const subtreeContext = yield _this5.presenterAPI.programTreeService.getSubtreeContextFromProgramNodeById(currentNodeId);\n            // 遍历祖先节点，找到 ellipse-pg 节点\n            var _iteratorAbruptCompletion3 = false;\n            var _didIteratorError3 = false;\n            var _iteratorError3;\n            try {\n              for (var _iterator3 = _asyncIterator(subtreeContext.ancestors), _step3; _iteratorAbruptCompletion3 = !(_step3 = yield _iterator3.next()).done; _iteratorAbruptCompletion3 = false) {\n                const ancestor = _step3.value;\n                {\n                  if (ancestor.node && ancestor.node.type === 'funh-ellipse-polyscopex-ellipse-pg') {\n                    currentNodeId = ancestor.id;\n                    console.log(`Found ellipse-pg parent node ID: ${currentNodeId}`);\n                    break;\n                  }\n                }\n              }\n              // 如果还是没找到，尝试使用 contributedNode 的类型来查找\n            } catch (err) {\n              _didIteratorError3 = true;\n              _iteratorError3 = err;\n            } finally {\n              try {\n                if (_iteratorAbruptCompletion3 && _iterator3.return != null) {\n                  yield _iterator3.return();\n                }\n              } finally {\n                if (_didIteratorError3) {\n                  throw _iteratorError3;\n                }\n              }\n            }\n            if (currentNode.type !== 'funh-ellipse-polyscopex-ellipse-pg') {\n              // 获取所有 ellipse-pg 节点实例\n              const instances = yield _this5.presenterAPI.programTreeService.getContributedNodeInstancesForURCap();\n              const ellipsePgInstance = instances.find(inst => inst.node.type === 'funh-ellipse-polyscopex-ellipse-pg');\n              if (ellipsePgInstance) {\n                currentNodeId = ellipsePgInstance.id;\n                console.log(`Found ellipse-pg node from instances: ${currentNodeId}`);\n              }\n            }\n          }\n          if (!currentNodeId) {\n            console.error('Could not find ellipse-pg node ID. Cannot delete child nodes.');\n            return;\n          }\n          console.log(`Using node ID for deletion: ${currentNodeId}`);\n          const subtreeContext = yield _this5.presenterAPI.programTreeService.getSubtreeContextFromProgramNodeById(currentNodeId);\n          // 收集所有子节点的 ID\n          const childNodeIds = [];\n          var _iteratorAbruptCompletion4 = false;\n          var _didIteratorError4 = false;\n          var _iteratorError4;\n          try {\n            for (var _iterator4 = _asyncIterator(subtreeContext.children), _step4; _iteratorAbruptCompletion4 = !(_step4 = yield _iterator4.next()).done; _iteratorAbruptCompletion4 = false) {\n              const child = _step4.value;\n              {\n                if (child.id) {\n                  childNodeIds.push(child.id);\n                  console.log(`Found child node: ${child.id}, type: ${child.node?.type}`);\n                }\n              }\n            }\n          } catch (err) {\n            _didIteratorError4 = true;\n            _iteratorError4 = err;\n          } finally {\n            try {\n              if (_iteratorAbruptCompletion4 && _iterator4.return != null) {\n                yield _iterator4.return();\n              }\n            } finally {\n              if (_didIteratorError4) {\n                throw _iteratorError4;\n              }\n            }\n          }\n          console.log(`Found ${childNodeIds.length} child nodes`);\n          if (childNodeIds.length === 0) {\n            console.log('No child nodes to delete');\n            return;\n          }\n          // 只删除最后一个子节点\n          const lastChildNodeId = childNodeIds[childNodeIds.length - 1];\n          const removeNode = {\n            nodeId: lastChildNodeId,\n            changeSelection: false\n          };\n          console.log(`Attempting to delete last child node: ${lastChildNodeId}`);\n          try {\n            yield _this5.presenterAPI.programTreeService.removeChildNode(removeNode);\n            console.log(`Delete API call completed for node: ${lastChildNodeId}`);\n            // 等待一段时间，确保删除操作完成\n            yield new Promise(resolve => setTimeout(resolve, 200));\n            // 验证删除是否成功\n            const verifyContext = yield _this5.presenterAPI.programTreeService.getSubtreeContextFromProgramNodeById(currentNodeId);\n            const remainingChildIds = [];\n            var _iteratorAbruptCompletion5 = false;\n            var _didIteratorError5 = false;\n            var _iteratorError5;\n            try {\n              for (var _iterator5 = _asyncIterator(verifyContext.children), _step5; _iteratorAbruptCompletion5 = !(_step5 = yield _iterator5.next()).done; _iteratorAbruptCompletion5 = false) {\n                const child = _step5.value;\n                {\n                  if (child.id) {\n                    remainingChildIds.push(child.id);\n                  }\n                }\n              }\n            } catch (err) {\n              _didIteratorError5 = true;\n              _iteratorError5 = err;\n            } finally {\n              try {\n                if (_iteratorAbruptCompletion5 && _iterator5.return != null) {\n                  yield _iterator5.return();\n                }\n              } finally {\n                if (_didIteratorError5) {\n                  throw _iteratorError5;\n                }\n              }\n            }\n            const wasDeleted = !remainingChildIds.includes(lastChildNodeId);\n            if (wasDeleted) {\n              console.log(`Successfully deleted last child node: ${lastChildNodeId}`);\n              console.log(`Remaining child nodes: ${remainingChildIds.length}`);\n            } else {\n              console.warn(`Warning: Node ${lastChildNodeId} still exists after deletion attempt`);\n              console.warn(`Remaining child node IDs:`, remainingChildIds);\n            }\n            // 触发变更检测，确保 UI 更新\n            _this5.cd.detectChanges();\n          } catch (error) {\n            console.error(`Failed to delete child node ${lastChildNodeId}:`, error);\n            throw error;\n          }\n        } catch (error) {\n          console.error('Error deleting child node:', error);\n          console.error('Error details:', JSON.stringify(error, null, 2));\n        }\n      })();\n    }\n    static ɵfac = function EllipsePgComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || EllipsePgComponent)(i0.ɵɵdirectiveInject(i1.TranslateService), i0.ɵɵdirectiveInject(i0.ChangeDetectorRef));\n    };\n    static ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: EllipsePgComponent,\n      selectors: [[\"ng-component\"]],\n      inputs: {\n        presenterAPI: \"presenterAPI\",\n        robotSettings: \"robotSettings\",\n        contributedNode: \"contributedNode\"\n      },\n      standalone: false,\n      features: [i0.ɵɵNgOnChangesFeature],\n      decls: 1,\n      vars: 1,\n      consts: [[1, \"inline-component\"], [3, \"text\", \"type\", \"weight\"], [\"type\", \"cta\", \"icon\", \"record\", \"iconAlign\", \"left\", 3, \"handleClick\", \"disabled\", \"active\"], [\"type\", \"filled\", \"icon\", \"manual\", \"iconAlign\", \"left\", 3, \"handleClick\", \"disabled\", \"active\"]],\n      template: function EllipsePgComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵtemplate(0, EllipsePgComponent_Conditional_0_Template, 9, 11, \"div\", 0);\n        }\n        if (rf & 2) {\n          i0.ɵɵconditional(ctx.contributedNode ? 0 : -1);\n        }\n      },\n      dependencies: [i2.URButtonComponent, i2.URTitleComponent, i1.TranslatePipe],\n      styles: [\".inline-component[_ngcontent-%COMP%]{display:flex;align-items:center;height:40px;gap:var(--spacing-03)}\"],\n      changeDetection: 0\n    });\n  }\n  return EllipsePgComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}